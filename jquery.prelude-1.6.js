// Generated by CoffeeScript 1.3.3
/*
# jQuery Prelude - jQuery Plugin
# Simple preloader plug-in
#
# Examples and document at http://oame.github.com/jquery.prelude
#
# Copyright(C) 2012 o_ame - http://oameya.com
# version: 1.6
# require: jQuery 1.7.2+
# license: MIT License
*/(function(){(function(e){var t,n,r,i,s,o,u,a,f;Array.prototype.remove=function(t){var n,r;if(function(){var i,s,o;o=[];for(r=i=0,s=this.length;i<s;r=++i){n=this[r];o.push(e(n).data("preload")===t)}return o}.call(this))return this.splice(r,1)};t={collect_objects:function(t){var n;n=[];e(""+t+" *").each(function(){if(e(this).data("preload")!=null)return n.push(this)});return n},sniff_tags:function(t){return e(""+t+" img,audio").each(function(){if(e(this).attr("src")!=null)return e(this).attr("data-preload",e(this).attr("src"))})},preload_objects:function(t,n){var r;r=t.length;return e(t).each(function(){var i,s,o,u;o=e(this).data("preload");if(this.tagName==="AUDIO"){i=e("<audio/>").attr("src",o).load();return i.on("canplay canplaythrough",function(){t.remove(o);return n(r,r-t.length)})}s=e("<img/>").attr({src:o});u=e.browser;if(u.msie&&s.width()!==0){t.remove(o);return n(r,r-t.length)}return s.load(function(){t.remove(o);return n(r,r-t.length)})})},replace_objects_to_appear:function(t){return e(t).each(function(){switch(this.tagName){case"IMG":return e(this).attr({src:e(this).data("preload")});case"AUDIO":return e(this).attr({src:e(this).data("preload")});default:return e(this).css({"background-image":"url( "+e(this).data("preload")+" )"})}})},auto_assets:function(t){var r,i,s;s=e("<div/>").attr("id","prelude-wrapper");r=e("<div/>").attr("id","prelude-slider");r.append(e("<span/>"));if(n.show_text){i=e("<div/>").attr({id:"prelude-text-layer"});i.append(e("<p/>").attr("id","prelude-text"));s.append(i)}s.append(r);return e(t).prepend(s)},stat_log:function(e){return console.log("["+e+"] displayed_count: "+r+" finished_count: "+s+" total_count: "+f+" now_perc: "+o+" displayed_perc: "+i)}};a=null;u=[];o=0;i=0;f=0;s=0;r=0;n={animate:!0,smart_prelude:!0,auto_assets:!0,auto_hide:!0,hide_speed:1e3,show_text:!0,loading_text:":percent %",animation:{interval:20,speed:1e3}};return e.fn.prelude=function(l){var c;l!=null&&(l={});n=jQuery.extend(n,l);n.top_node=e(this).selector;n.html={};n.html.wrapper=""+n.top_node+" > #prelude-wrapper";n.html.slider=""+n.html.wrapper+" > #prelude-slider";n.html.indicator=""+n.html.slider+" > span";n.html.text_node=""+n.html.wrapper+" > #prelude-text-layer > #prelude-text";n.html.insersion=":percent";n.smart_prelude!=null&&t.sniff_tags(n.top_node);n.auto_assets!=null&&t.auto_assets(n.top_node);u=t.collect_objects(n.top_node);f=u.length;t.preload_objects(e.extend(!0,[],u),function(e,t){o=Math.ceil(100*t/e);return s+=1});if(n.animate){c=!0;return a=window.setInterval(function(){var o,l;if(f<=r&&c===!1){window.clearInterval(a);t.replace_objects_to_appear(u);return n.auto_hide?e(n.html.wrapper).fadeOut(n.hide_speed,function(){return e(n.top_node).trigger("preloaded")}):e(n.top_node).trigger("preloaded")}l=parseInt(e(n.html.slider).css("width"));o=parseInt(e(n.html.indicator).css("width"));i=Math.ceil(o/l*100);e(n.top_node).trigger("preload_progress",[i,s,f]);n.show_text!=null&&e(n.html.text_node).html(n.loading_text.replace(n.html.insersion,i));if(r<s){c=!0;r+=1;e(n.html.indicator).stop();return e(n.html.indicator).animate({width:r/f*100+"%"},n.speed,function(){return c=!1})}},n.interval)}return a=window.setInterval(function(){if(i>=100){window.clearInterval(a);t.replace_objects_to_appear(u);return n.auto_hide?e(n.html.wrapper).fadeOut(n.hide_speed,function(){return e(n.top_node).trigger("preloaded")}):e(n.top_node).trigger("preloaded")}if(i<o){i+=1;n.show_text!=null&&e(n.html.text_node).html(n.loading_text.replace(":percent",i));e(n.html.indicator).css({width:""+i+" %"});return e(n.top_node).trigger("preload_progress",[i,s,f])}},n.animation.interval)}})(jQuery)}).call(this);