/*
 * Naz - jQuery Plugin
 * Simple preloader
 *
 * Examples and document at http://oame.github.com/jquery.naz
 *
 * Copyright(C) 2012 oame
 * version: 1.1
 * require: jQuery 1.7.2+
 * license: MIT License
 */(function(e,t){function n(t){var n=[];e(t+" *").each(function(){typeof e(this).data("naz-src")!="undefined"&&n.push(this)});return n}function r(t){e(t+" img,audio").each(function(){typeof e(this).data("naz-src")=="undefined"&&typeof e(this).attr("src")!="undefined"&&e(this).attr("data-naz-src",e(this).attr("src"))})}function i(t,n){var r=t.length;e(t).each(function(){var i=e(this).data("naz-src");if(this.tagName=="AUDIO"){var s=e("<audio/>").attr("src",i).load();s.on("canplay canplaythrough",function(){t.remove(i);n(r,r-t.length)})}else e("<img/>").attr("src",i).load(function(){t.remove(i);n(r,r-t.length)})})}function s(t){e(t).each(function(){switch(this.tagName){case"IMG":e(this).attr("src",e(this).data("naz-src"));break;case"AUDIO":e(this).attr("src",e(this).data("naz-src"));break;default:e(this).css("background-image","url("+e(this).data("naz-src")+")")}})}function o(t){var n=e("<div/>").attr("id","naz-wrapper"),r=e("<div/>").attr("id","naz-slider");r.append(e("<span/>"));if(v.show_text){var i=e("<div/>").attr("id","naz-text-layer");i.append(e("<p/>").attr("id","naz-text"));n.append(i)}n.append(r);e(t).prepend(n)}function u(e){console.log("["+e+"] displayed_count: "+d+" finished_count: "+p+" total_count: "+h+" now_perc: "+l+" displayed_perc: "+c)}Array.prototype.remove=function(t){for(var n=0;n<this.length;n++)e(this[n]).data("naz-src")==t&&this.splice(n,1)};var a,f,l,c,h,p,d,v;a=null;f=[];l=0;c=0;h=0;p=0;d=0;v={animate:!1,interval:20,smart_naz:!0,auto_assets:!0,auto_hide:!0,show_text:!0,loadingText:":percent %",animation:{speed:1e3}};e.fn.naz=function(t){typeof t=="undefined"&&(t={});v=jQuery.extend(v,t);v.top_node=e(this).selector;v.html={};v.html.wrapper=v.top_node+" > #naz-wrapper";v.html.indicator=v.html.wrapper+" > #naz-slider > span";v.html.text_node=v.html.wrapper+" > #naz-text-layer > #naz-text";v.html.insersion=":percent";v.smart_naz&&r(v.top_node);v.auto_assets&&o(v.top_node);f=n(v.top_node);h=f.length;i(e.extend(!0,[],f),function(e,t){l=Math.ceil(100*t/e);p+=1});e(v.top_node).on("naz_preloaded",function(t){v.auto_hide&&e(v.html.wrapper).fadeOut("slow")});if(v.animate){var u=!0;a=window.setInterval(function(){if(h<=d&&u==0){window.clearInterval(a);s(f);e(v.top_node).trigger("naz_preloaded")}else if(d<p){u=!0;c=l;d+=1;v.show_text&&e(v.html.text_node).html(v.loadingText.replace(v.html.insersion,c));e(v.html.indicator).stop();e(v.html.indicator).animate({width:d/h*100+"%"},v.speed,function(){u=!1});e(v.top_node).trigger("naz_progress",[l,p,h])}},v.interval)}else a=window.setInterval(function(){if(c>=100){window.clearInterval(a);s(f);e(v.top_node).trigger("naz_preloaded")}else if(c<l){c+=1;v.show_text&&e(v.html.text_node).html(v.loadingText.replace(":percent",c));e(v.html.indicator).css("width",c+"%");e(v.top_node).trigger("naz_progress",[l,p,h])}},v.interval)}})(jQuery);