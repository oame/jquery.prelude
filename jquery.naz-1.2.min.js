/*
 * jquery.naz - jQuery Plugin
 * Simple preloader
 *
 * Examples and document at http://oame.github.com/jquery.naz
 *
 * Copyright(C) 2012 oame - http://oameya.com
 * version: 1.2
 * require: jQuery 1.7.2+
 * license: MIT License
 */(function(e,t){Array.prototype.remove=function(t){for(var n=0;n<this.length;n++)e(this[n]).data("naz-src")==t&&this.splice(n,1)};$naz={collect_objects:function(t){var n=[];e(t+" *").each(function(){typeof e(this).data("naz-src")!="undefined"&&n.push(this)});return n},sniff_tags:function(t){e(t+" img,audio").each(function(){typeof e(this).data("naz-src")=="undefined"&&typeof e(this).attr("src")!="undefined"&&e(this).attr("data-naz-src",e(this).attr("src"))})},preload_objects:function(t,n){var r=t.length;e(t).each(function(){var i=e(this).data("naz-src");if(this.tagName=="AUDIO"){var s=e("<audio/>").attr("src",i).load();s.on("canplay canplaythrough",function(){t.remove(i);n(r,r-t.length)})}else e("<img/>").attr("src",i).load(function(){t.remove(i);n(r,r-t.length)})})},replace_objects_to_appear:function(t){e(t).each(function(){switch(this.tagName){case"IMG":e(this).attr("src",e(this).data("naz-src"));break;case"AUDIO":e(this).attr("src",e(this).data("naz-src"));break;default:e(this).css("background-image","url("+e(this).data("naz-src")+")")}})},auto_assets:function(t){var n=e("<div/>").attr("id","naz-wrapper"),r=e("<div/>").attr("id","naz-slider");r.append(e("<span/>"));if(f.show_text){var i=e("<div/>").attr("id","naz-text-layer");i.append(e("<p/>").attr("id","naz-text"));n.append(i)}n.append(r);e(t).prepend(n)},stat_log:function(e){console.log("["+e+"] displayed_count: "+a+" finished_count: "+u+" total_count: "+o+" now_perc: "+i+" displayed_perc: "+s)}};var n,r,i,s,o,u,a,f;n=null;r=[];i=0;s=0;o=0;u=0;a=0;f={animate:!1,interval:20,smart_naz:!0,auto_assets:!0,auto_hide:!0,show_text:!0,loading_text:":percent %",animation:{speed:1e3}};e.fn.naz=function(t){typeof t=="undefined"&&(t={});f=jQuery.extend(f,t);f.top_node=e(this).selector;f.html={};f.html.wrapper=f.top_node+" > #naz-wrapper";f.html.indicator=f.html.wrapper+" > #naz-slider > span";f.html.text_node=f.html.wrapper+" > #naz-text-layer > #naz-text";f.html.insersion=":percent";f.smart_naz&&$naz.sniff_tags(f.top_node);f.auto_assets&&$naz.auto_assets(f.top_node);r=$naz.collect_objects(f.top_node);o=r.length;$naz.preload_objects(e.extend(!0,[],r),function(e,t){i=Math.ceil(100*t/e);u+=1});if(f.animate){var l=!0;n=window.setInterval(function(){if(o<=a&&l==0){window.clearInterval(n);$naz.replace_objects_to_appear(r);f.auto_hide?e(f.html.wrapper).fadeOut("slow",function(){e(f.top_node).trigger("naz_preloaded")}):e(f.top_node).trigger("naz_preloaded")}else if(a<u){l=!0;s=i;a+=1;f.show_text&&e(f.html.text_node).html(f.loading_text.replace(f.html.insersion,s));e(f.html.indicator).stop();e(f.html.indicator).animate({width:a/o*100+"%"},f.speed,function(){l=!1});e(f.top_node).trigger("naz_progress",[s,u,o])}},f.interval)}else n=window.setInterval(function(){if(s>=100){window.clearInterval(n);$naz.replace_objects_to_appear(r);f.auto_hide?e(f.html.wrapper).fadeOut("slow",function(){e(f.top_node).trigger("naz_preloaded")}):e(f.top_node).trigger("naz_preloaded")}else if(s<i){s+=1;f.show_text&&e(f.html.text_node).html(f.loading_text.replace(":percent",s));e(f.html.indicator).css("width",s+"%");e(f.top_node).trigger("naz_progress",[s,u,o])}},f.interval)}})(jQuery);