/*
* Naz - jQuery Plugin
* Simple preloader
*
* Examples and document at http://oame.github.com/jquery.naz
*
* Copyright(C) 2012 oame
* version: 1.0
* require: jQuery 1.7.2+
* license: MIT License
*/(function(e){function t(){var t=[];e("body *").each(function(){e(this).data("naz-src")!=undefined&&t.push(this)});return t}function n(){e("img,audio").each(function(){typeof e(this).data("naz-src")=="undefined"&&typeof e(this).attr("src")!="undefined"&&e(this).attr("data-naz-src",e(this).attr("src"))})}function r(t,n){var r=t.length;e(t).each(function(){var i=e(this).data("naz-src");if(this.tagName=="AUDIO"){var s=e("<audio/>").attr("src",i).load();s.on("canplay canplaythrough",function(){t.remove(i);n(r,r-t.length)})}else e("<img/>").attr("src",i).load(function(){t.remove(i);n(r,r-t.length)})})}function i(t){e(t).each(function(){switch(this.tagName){case"IMG":e(this).attr("src",e(this).data("naz-src"));break;case"AUDIO":e(this).attr("src",e(this).data("naz-src"));break;default:e(this).css("background-image","url("+e(this).data("naz-src")+")")}})}function s(){var e=$("<div/>").attr("id","nz-slider");e.append($("<span/>"));var t=$("<div/>").attr("id","nz-text-layer");t.append($("<p/>").attr("id","nz-text"));var n=$("<div/>").attr("id","nz-wrapper");n.append(e);n.append(t);$("body").append(n)}Array.prototype.remove=function(t){for(var n=0;n<this.length;n++)e(this[n]).data("naz-src")===t&&this.splice(n,1)};var o,u,a,f,l,c,h,p,d;o=null;u=[];a=0;f=0;l=0;c=0;h=0;d=!1;p={animate:!1,interval:20,smart_naz:!0,auto_assets:!0,animation:{speed:1e3,loadingText:"Loading..."},nonanimate:{loadingText:":percent %"}};e.fn.naz=function(v,m){typeof m=="undefined"&&(m=null);p=e.extend(p,v);p.smart_naz&&n();p.auto_assets&&s();u=t();l=u.length;dupObjects=e.extend(!0,[],u);r(dupObjects,function(e,t){a=Math.ceil(100*t/e);c+=1});d=!0;if(p.animate){e("#nz-text").html(p.animation.loadingText);o=window.setInterval(function(){if(l>=c&&d==0){window.clearInterval(o);i(u);e("#nz-wrapper").fadeOut("slow",function(){$(this).trigger("preloaded")})}else if(h<c){e("#nz-slider > span").stop();h+=1;e("#nz-slider > span").animate({width:h/l*100+"%"},p.speed,function(){d=!1})}},p.interval)}else o=window.setInterval(function(){if(f>=100){window.clearInterval(o);i(u);e("#nz-wrapper").fadeOut("slow",function(){$(this).trigger("preloaded")})}else if(f<a){f+=1;e("#nz-text").html(p.nonanimate.loadingText.replace(":percent",f));e("#nz-slider > span").css("width",f+"%")}},p.interval)}})(jQuery);